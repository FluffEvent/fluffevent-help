---
import YAML from 'yaml'

import streamersListYml from '~/data/streamers/2023.yml?raw'
import streamersSocialsYml from '~/data/streamers/socials.yml?raw'

interface StreamerSocials {
	name: string
	country: string
	socials: Array<{
		platform: string
		url: string
	}>
}

const streamersList = YAML.parse(streamersListYml) as Array<string>
const streamersSocials = YAML.parse(streamersSocialsYml) as Record<string, StreamerSocials>

const streamers: Array<StreamerSocials> = streamersList.map(
	(name) => streamersSocials[name] || { name, country: '?', socials: [] }
)

const countryFlag: Record<string, string> = {
	'AUS': 'australia',
	'BEL': 'belgium',
	'CAN': 'canada',
	'CHE': 'switzerland',
	'ESP': 'spain',
	'FRA': 'france',
	'GBR': 'united-kingdom',
	'IDN': 'indonesia',
	'ITA': 'italy',
	'USA': 'united-states',
}

const socialIcons: Record<string, string> = {
	'twitch': 'mdi--twitch',
	'twitter': 'mdi--twitter',
	'youtube': 'mdi--youtube',
	'tiktok': 'ic--baseline-tiktok',
	'instagram': 'mdi--instagram',
}
---

<table>

	<thead>
		<tr>
			<th><span class="sr-only">Nationalité</span></th>
			<th>Participant</th>
			<th>Réseaux sociaux</th>
		</tr>
	</thead>

	<tbody>
		{streamers.map((streamer) => (
			<tr>
				<td>
					{countryFlag[streamer.country] !== undefined
						? <span class={`icon-[twemoji--flag-${countryFlag[streamer.country]}] icon-align icon-fw`}></span>
						: <em>{streamer.country}</em>
					}
				</td>
				<td>{streamer.name}</td>
				<td>
					{streamer.socials.map((social, index) => (
						<>
							<a href={social.url} target="_blank" rel="noopener noreferrer">{
								socialIcons[social.platform.toLowerCase()] !== undefined
									? <span class={`icon-[${socialIcons[social.platform.toLowerCase()]}] icon-align icon-fw`}></span>
									: <em>{social.platform}</em>
							}</a>{index < streamer.socials.length - 1 && ', '}
						</>
					))}
				</td>
			</tr>
		))}
	</tbody>

</table>
